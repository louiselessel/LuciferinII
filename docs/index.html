<!DOCTYPE html>
<html lang="en">
	<head>
		<title>Luciferin II, by Louise Lessel</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0, 
		maximum-scale=1.0, minimum-scale=1.0, user-scalable=no" />
		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black" />
		<meta charset="utf-8">
		<link rel="manifest" href="./manifest.json">
		<meta name="mobile-web-app-capable" content="yes">
		<meta name="theme-color" content="#000000">
		<link type="text/css" rel="stylesheet" href="main.css">
		<style type="text/css">
			html, body {
				height: 101vh; /* force scroll */
				width: 100%;
				margin: 0;
				background-color: black;
   				color: white;
				/* Disable zooming */
				touch-action: manipulation;
				user-select: none;
				-ms-touch-action: none;
			}
			#container {
				min-height: 100%; 
				min-width: 100%; 
				background-color: black;
    			color: white;
				/* Disable zooming */
				touch-action: manipulation;
				user-select: none;
				-ms-touch-action: none;
			}
		</style>
		<!--[if lte IE 6]>
		<style type="text/css">
			#container {
				height: 100%;
			}
		</style>
		<![endif]-->
	</head>

	<body>
		<div id="container"></div>
		<script id="vertexShader" type="x-shader/x-vertex">
			varying vec2 vUv;

			void main() {
				vUv = uv;
				gl_Position = vec4( position, 1.0 );
			}
		</script>

		<script id="fragmentShader" type="x-shader/x-fragment">
			varying vec2 vUv;
			uniform float time;
			uniform vec3 iResolution;

			// ShaderToy variables
			#define iTime time
			#define ratio (iResolution.x / iResolution.y)
			#define speed 0.5
			#define PI 3.1415926535897932384626433832795
			#define CENTER(w, h, s) vec2((cos(iTime * w * speed + s) + 1.0) * 0.5, (sin(iTime * h * speed + s) + 1.0) * 0.5)

			vec4 firefly(vec2 uv, vec2 center, float size, float intensity, vec3 color, float cycleT, float pauseT, float offsetT, float w) {
				// make round
				uv.x *= ratio;
				center.x *= ratio;

				// wiggle
				float wx = cos(iTime * 3.0) * w + 1.0;
				float wy = sin(iTime * speed * 2.0) * 0.02 + 1.0;
				center.y *= wy;
				center.x *= wx;

				// light radius and flash
				vec2 dist = (center.xy - uv.xy) * size;
				float flash = 1.0 / dot(dist, dist);

				// color the firefly
				vec4 newColor = vec4(color * flash * intensity, 1.0);
				return newColor;
			}

			void main() {
				vec2 uv = gl_FragCoord.xy / iResolution.xy; // map to full screen
				vec4 fireflies = vec4(0.0);

				// Example firefly for testing
				fireflies += firefly(uv, CENTER(0.5, 0.5, 0.0), 100.0, 1.0, vec3(1.0, 1.0, 0.0), 6.0, 3.0, 0.0, 0.1);

				gl_FragColor = fireflies;
			}
		</script>

		<script type="text/javascript">
			const container = document.getElementById("container");
			const scene = new THREE.Scene();
			const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
			const renderer = new THREE.WebGLRenderer();
			renderer.setSize(window.innerWidth, window.innerHeight);
			container.appendChild(renderer.domElement);

			const uniforms = {
				time: { value: 1.0 },
				iResolution: { value: new THREE.Vector3() }
			};

			const material = new THREE.ShaderMaterial({
				uniforms: uniforms,
				vertexShader: document.getElementById('vertexShader').textContent,
				fragmentShader: document.getElementById('fragmentShader').textContent
			});

			const plane = new THREE.PlaneGeometry(2, 2);
			const mesh = new THREE.Mesh(plane, material);
			scene.add(mesh);

			camera.position.z = 1;

			function animate() {
				uniforms.time.value += 0.05;
				uniforms.iResolution.value.set(window.innerWidth, window.innerHeight, 1);
				requestAnimationFrame(animate);
				renderer.render(scene, camera);
			}
			animate();
		</script>
	</body>
</html>
